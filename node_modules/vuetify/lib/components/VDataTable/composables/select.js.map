{"version":3,"file":"select.js","names":["useProxiedModel","computed","inject","provide","shallowRef","toRef","deepEqual","isPrimitive","propsFactory","wrapInArray","singleSelectStrategy","showSelectAll","allSelected","select","items","value","Set","selectAll","selected","pageSelectStrategy","currentPage","item","add","delete","allSelectStrategy","allItems","map","makeDataTableSelectProps","showSelect","Boolean","selectStrategy","type","String","Object","default","modelValue","Array","valueComparator","Function","VDataTableSelectionSymbol","Symbol","for","provideSelection","props","v","customComparator","find","values","allSelectable","filter","selectable","currentPageSelectable","lastSelectedIndex","isSelected","every","has","isSomeSelected","some","newSelected","toggleSelect","index","event","findIndex","i","shiftKey","start","end","sort","a","b","push","slice","someSelected","size","length","data","useSelection","Error"],"sources":["../../../../src/components/VDataTable/composables/select.ts"],"sourcesContent":["// Composables\nimport { useProxiedModel } from '@/composables/proxiedModel'\n\n// Utilities\nimport { computed, inject, provide, shallowRef, toRef } from 'vue'\nimport { deepEqual, isPrimitive, propsFactory, wrapInArray } from '@/util'\n\n// Types\nimport type { InjectionKey, PropType, Ref } from 'vue'\nimport type { DataTableItemProps } from './items'\nimport type { EventProp, ValueComparator } from '@/util'\n\nexport interface SelectableItem {\n  value: any\n  selectable: boolean\n}\n\nexport interface DataTableSelectStrategy {\n  showSelectAll: boolean\n  allSelected: (data: {\n    allItems: SelectableItem[]\n    currentPage: SelectableItem[]\n  }) => SelectableItem[]\n  select: (data: {\n    items: SelectableItem[]\n    value: boolean\n    selected: Set<unknown>\n  }) => Set<unknown>\n  selectAll: (data: {\n    value: boolean\n    allItems: SelectableItem[]\n    currentPage: SelectableItem[]\n    selected: Set<unknown>\n  }) => Set<unknown>\n}\n\ntype SelectionProps = Pick<DataTableItemProps, 'itemValue'> & {\n  modelValue: readonly any[]\n  selectStrategy: 'single' | 'page' | 'all'\n  valueComparator?: ValueComparator\n  'onUpdate:modelValue': EventProp<[any[]]> | undefined\n}\n\nconst singleSelectStrategy: DataTableSelectStrategy = {\n  showSelectAll: false,\n  allSelected: () => [],\n  select: ({ items, value }) => {\n    return new Set(value ? [items[0]?.value] : [])\n  },\n  selectAll: ({ selected }) => selected,\n}\n\nconst pageSelectStrategy: DataTableSelectStrategy = {\n  showSelectAll: true,\n  allSelected: ({ currentPage }) => currentPage,\n  select: ({ items, value, selected }) => {\n    for (const item of items) {\n      if (value) selected.add(item.value)\n      else selected.delete(item.value)\n    }\n\n    return selected\n  },\n  selectAll: ({ value, currentPage, selected }) => pageSelectStrategy.select({ items: currentPage, value, selected }),\n}\n\nconst allSelectStrategy: DataTableSelectStrategy = {\n  showSelectAll: true,\n  allSelected: ({ allItems }) => allItems,\n  select: ({ items, value, selected }) => {\n    for (const item of items) {\n      if (value) selected.add(item.value)\n      else selected.delete(item.value)\n    }\n\n    return selected\n  },\n  selectAll: ({ value, allItems }) => {\n    return new Set(value ? allItems.map(item => item.value) : [])\n  },\n}\n\nexport const makeDataTableSelectProps = propsFactory({\n  showSelect: Boolean,\n  selectStrategy: {\n    type: [String, Object] as PropType<'single' | 'page' | 'all'>,\n    default: 'page',\n  },\n  modelValue: {\n    type: Array as PropType<readonly any[]>,\n    default: () => ([]),\n  },\n  valueComparator: Function as PropType<ValueComparator>,\n}, 'DataTable-select')\n\nexport const VDataTableSelectionSymbol: InjectionKey<ReturnType<typeof provideSelection>> = Symbol.for('vuetify:data-table-selection')\n\nexport function provideSelection (\n  props: SelectionProps,\n  { allItems, currentPage }: { allItems: Ref<SelectableItem[]>, currentPage: Ref<SelectableItem[]> }\n) {\n  const selected = useProxiedModel(props, 'modelValue', props.modelValue, v => {\n    const customComparator = props.valueComparator\n    if (customComparator) {\n      return new Set(wrapInArray(v).map(v => {\n        return allItems.value.find(item => customComparator(v, item.value))?.value ?? v\n      }))\n    }\n    return new Set(wrapInArray(v).map(v => {\n      return isPrimitive(v)\n        ? allItems.value.find(item => v === item.value)?.value ?? v\n        : allItems.value.find(item => deepEqual(v, item.value))?.value ?? v\n    }))\n  }, v => {\n    return [...v.values()]\n  })\n\n  const allSelectable = computed(() => allItems.value.filter(item => item.selectable))\n  const currentPageSelectable = computed(() => currentPage.value.filter(item => item.selectable))\n\n  const selectStrategy = computed(() => {\n    if (typeof props.selectStrategy === 'object') return props.selectStrategy\n\n    switch (props.selectStrategy) {\n      case 'single': return singleSelectStrategy\n      case 'all': return allSelectStrategy\n      case 'page':\n      default: return pageSelectStrategy\n    }\n  })\n\n  const lastSelectedIndex = shallowRef<number | null>(null)\n\n  function isSelected (items: SelectableItem | SelectableItem[]) {\n    return wrapInArray(items).every(item => selected.value.has(item.value))\n  }\n\n  function isSomeSelected (items: SelectableItem | SelectableItem[]) {\n    return wrapInArray(items).some(item => selected.value.has(item.value))\n  }\n\n  function select (items: SelectableItem[], value: boolean) {\n    const newSelected = selectStrategy.value.select({\n      items,\n      value,\n      selected: new Set(selected.value),\n    })\n\n    selected.value = newSelected\n  }\n\n  function toggleSelect (item: SelectableItem, index?: number, event?: MouseEvent) {\n    const items = []\n    index = index ?? currentPage.value.findIndex(i => i.value === item.value)\n\n    if (props.selectStrategy !== 'single' && event?.shiftKey && lastSelectedIndex.value !== null) {\n      const [start, end] = [lastSelectedIndex.value, index].sort((a, b) => a - b)\n\n      items.push(...currentPage.value.slice(start, end + 1).filter(item => item.selectable))\n    } else {\n      items.push(item)\n      lastSelectedIndex.value = index\n    }\n\n    select(items, !isSelected([item]))\n  }\n\n  function selectAll (value: boolean) {\n    const newSelected = selectStrategy.value.selectAll({\n      value,\n      allItems: allSelectable.value,\n      currentPage: currentPageSelectable.value,\n      selected: new Set(selected.value),\n    })\n\n    selected.value = newSelected\n  }\n\n  const someSelected = computed(() => selected.value.size > 0)\n  const allSelected = computed(() => {\n    const items = selectStrategy.value.allSelected({\n      allItems: allSelectable.value,\n      currentPage: currentPageSelectable.value,\n    })\n    return !!items.length && isSelected(items)\n  })\n  const showSelectAll = toRef(() => selectStrategy.value.showSelectAll)\n\n  const data = {\n    toggleSelect,\n    select,\n    selectAll,\n    isSelected,\n    isSomeSelected,\n    someSelected,\n    allSelected,\n    showSelectAll,\n    lastSelectedIndex,\n    selectStrategy,\n  }\n\n  provide(VDataTableSelectionSymbol, data)\n\n  return data\n}\n\nexport function useSelection () {\n  const data = inject(VDataTableSelectionSymbol)\n\n  if (!data) throw new Error('Missing selection!')\n\n  return data\n}\n"],"mappings":"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","ignoreList":[]}