{"version":3,"file":"VVirtualScroll.js","names":["VVirtualScrollItem","makeComponentProps","makeDimensionProps","useDimension","useToggleScope","makeVirtualProps","useVirtual","onMounted","onScopeDispose","toRef","convertToUnit","genericComponent","getCurrentInstance","getScrollParent","propsFactory","useRender","makeVVirtualScrollProps","items","type","Array","default","renderless","Boolean","VVirtualScroll","name","props","setup","slots","vm","dimensionStyles","calculateVisibleItems","containerRef","markerRef","handleScroll","handleScrollend","handleItemResize","scrollToIndex","paddingTop","paddingBottom","computedItems","handleListeners","add","method","value","document","documentElement","passive","vnode","el","children","map","item","_createVNode","key","height","index","slotProps","raw","_createElementVNode","_Fragment","_normalizeClass","class","_normalizeStyle","style"],"sources":["../../../src/components/VVirtualScroll/VVirtualScroll.tsx"],"sourcesContent":["// Styles\nimport './VVirtualScroll.sass'\n\n// Components\nimport { VVirtualScrollItem } from './VVirtualScrollItem'\n\n// Composables\nimport { makeComponentProps } from '@/composables/component'\nimport { makeDimensionProps, useDimension } from '@/composables/dimensions'\nimport { useToggleScope } from '@/composables/toggleScope'\nimport { makeVirtualProps, useVirtual } from '@/composables/virtual'\n\n// Utilities\nimport { onMounted, onScopeDispose, toRef } from 'vue'\nimport {\n  convertToUnit,\n  genericComponent,\n  getCurrentInstance,\n  getScrollParent,\n  propsFactory,\n  useRender,\n} from '@/util'\n\n// Types\nimport type { PropType, Ref } from 'vue'\nimport type { GenericProps } from '@/util'\n\nexport interface VVirtualScrollSlot<T> {\n  item: T\n  index: number\n}\n\nexport const makeVVirtualScrollProps = propsFactory({\n  items: {\n    type: Array as PropType<readonly unknown[]>,\n    default: () => ([]),\n  },\n  renderless: Boolean,\n\n  ...makeVirtualProps(),\n  ...makeComponentProps(),\n  ...makeDimensionProps(),\n}, 'VVirtualScroll')\n\nexport const VVirtualScroll = genericComponent<new <T, Renderless extends boolean = false>(\n  props: {\n    items?: readonly T[]\n    renderless?: Renderless\n  },\n  slots: {\n    default: VVirtualScrollSlot<T> & (Renderless extends true ? {\n      itemRef: Ref<HTMLElement | undefined>\n    } : {})\n  }\n) => GenericProps<typeof props, typeof slots>>()({\n  name: 'VVirtualScroll',\n\n  props: makeVVirtualScrollProps(),\n\n  setup (props, { slots }) {\n    const vm = getCurrentInstance('VVirtualScroll')\n    const { dimensionStyles } = useDimension(props)\n    const {\n      calculateVisibleItems,\n      containerRef,\n      markerRef,\n      handleScroll,\n      handleScrollend,\n      handleItemResize,\n      scrollToIndex,\n      paddingTop,\n      paddingBottom,\n      computedItems,\n    } = useVirtual(props, toRef(() => props.items))\n\n    useToggleScope(() => props.renderless, () => {\n      function handleListeners (add = false) {\n        const method = add ? 'addEventListener' : 'removeEventListener'\n\n        if (containerRef.value === document.documentElement) {\n          document[method]('scroll', handleScroll, { passive: true })\n          document[method]('scrollend', handleScrollend)\n        } else {\n          containerRef.value?.[method]('scroll', handleScroll, { passive: true })\n          containerRef.value?.[method]('scrollend', handleScrollend)\n        }\n      }\n\n      onMounted(() => {\n        containerRef.value = getScrollParent(vm.vnode.el as HTMLElement, true)\n        handleListeners(true)\n      })\n      onScopeDispose(handleListeners)\n    })\n\n    useRender(() => {\n      const children = computedItems.value.map(item => (\n        <VVirtualScrollItem\n          key={ item.key }\n          renderless={ props.renderless }\n          onUpdate:height={ height => handleItemResize(item.index, height) }\n        >\n          { slotProps => slots.default?.({ item: item.raw, index: item.index, ...slotProps }) }\n        </VVirtualScrollItem>\n      ))\n\n      return props.renderless ? (\n        <>\n          <div ref={ markerRef } class=\"v-virtual-scroll__spacer\" style={{ paddingTop: convertToUnit(paddingTop.value) }} />\n          { children }\n          <div class=\"v-virtual-scroll__spacer\" style={{ paddingBottom: convertToUnit(paddingBottom.value) }} />\n        </>\n      ) : (\n        <div\n          ref={ containerRef }\n          class={[\n            'v-virtual-scroll',\n            props.class,\n          ]}\n          onScrollPassive={ handleScroll }\n          onScrollend={ handleScrollend }\n          style={[\n            dimensionStyles.value,\n            props.style,\n          ]}\n        >\n          <div\n            ref={ markerRef }\n            class=\"v-virtual-scroll__container\"\n            style={{\n              paddingTop: convertToUnit(paddingTop.value),\n              paddingBottom: convertToUnit(paddingBottom.value),\n            }}\n          >\n            { children }\n          </div>\n        </div>\n      )\n    })\n\n    return {\n      calculateVisibleItems,\n      scrollToIndex,\n    }\n  },\n})\n\nexport type VVirtualScroll = InstanceType<typeof VVirtualScroll>\n"],"mappings":"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","ignoreList":[]}