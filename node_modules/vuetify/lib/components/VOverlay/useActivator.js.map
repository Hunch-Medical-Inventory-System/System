{"version":3,"file":"useActivator.js","names":["VMenuSymbol","makeDelayProps","useDelay","computed","effectScope","inject","mergeProps","nextTick","onScopeDispose","ref","watch","watchEffect","bindProps","getCurrentInstance","IN_BROWSER","matchesSelector","propsFactory","templateRef","unbindProps","makeActivatorProps","target","String","Object","activator","activatorProps","type","default","openOnClick","Boolean","undefined","openOnHover","openOnFocus","closeOnContentClick","useActivator","props","isActive","isTop","contentEl","vm","activatorEl","isHovered","isFocused","firstEnter","value","runOpenDelay","runCloseDelay","cursorTarget","availableEvents","onClick","e","stopPropagation","currentTarget","clientX","clientY","onMouseenter","onMouseleave","onFocus","onBlur","minDelay","activatorEvents","events","contentEvents","onFocusin","matches","onFocusout","menu","closeParents","scrimEvents","val","contains","document","activeElement","setTimeout","flush","activatorRef","el","targetRef","getTarget","targetEl","Array","isArray","scope","run","_useActivator","stop","immediate","oldVal","getActivator","unbindActivatorProps","bindActivatorProps","_props","selector","nodeType","Node","ELEMENT_NODE","proxy","$el","parentNode","hasAttribute","querySelector"],"sources":["../../../src/components/VOverlay/useActivator.tsx"],"sourcesContent":["// Components\nimport { VMenuSymbol } from '@/components/VMenu/shared'\n\n// Composables\nimport { makeDelayProps, useDelay } from '@/composables/delay'\n\n// Utilities\nimport {\n  computed,\n  effectScope,\n  inject,\n  mergeProps,\n  nextTick,\n  onScopeDispose,\n  ref,\n  watch,\n  watchEffect,\n} from 'vue'\nimport {\n  bindProps,\n  getCurrentInstance,\n  IN_BROWSER,\n  matchesSelector,\n  propsFactory,\n  templateRef,\n  unbindProps,\n} from '@/util'\n\n// Types\nimport type {\n  ComponentInternalInstance,\n  ComponentPublicInstance,\n  EffectScope,\n  PropType,\n  Ref,\n} from 'vue'\nimport type { DelayProps } from '@/composables/delay'\n\ninterface ActivatorProps extends DelayProps {\n  target: 'parent' | 'cursor' | (string & {}) | Element | ComponentPublicInstance | [x: number, y: number] | undefined\n  activator: 'parent' | (string & {}) | Element | ComponentPublicInstance | undefined\n  activatorProps: Record<string, any>\n\n  openOnClick: boolean | undefined\n  openOnHover: boolean\n  openOnFocus: boolean | undefined\n\n  closeOnContentClick: boolean\n}\n\nexport const makeActivatorProps = propsFactory({\n  target: [String, Object] as PropType<ActivatorProps['target']>,\n  activator: [String, Object] as PropType<ActivatorProps['activator']>,\n  activatorProps: {\n    type: Object as PropType<ActivatorProps['activatorProps']>,\n    default: () => ({}),\n  },\n\n  openOnClick: {\n    type: Boolean,\n    default: undefined,\n  },\n  openOnHover: Boolean,\n  openOnFocus: {\n    type: Boolean,\n    default: undefined,\n  },\n\n  closeOnContentClick: Boolean,\n\n  ...makeDelayProps(),\n}, 'VOverlay-activator')\n\nexport function useActivator (\n  props: ActivatorProps,\n  { isActive, isTop, contentEl }: {\n    isActive: Ref<boolean>\n    isTop: Ref<boolean>\n    contentEl: Ref<HTMLElement | undefined>\n  }\n) {\n  const vm = getCurrentInstance('useActivator')\n  const activatorEl = ref<HTMLElement>()\n\n  let isHovered = false\n  let isFocused = false\n  let firstEnter = true\n\n  const openOnFocus = computed(() => props.openOnFocus || (props.openOnFocus == null && props.openOnHover))\n  const openOnClick = computed(() => props.openOnClick || (props.openOnClick == null && !props.openOnHover && !openOnFocus.value))\n\n  const { runOpenDelay, runCloseDelay } = useDelay(props, value => {\n    if (\n      value === (\n        (props.openOnHover && isHovered) ||\n        (openOnFocus.value && isFocused)\n      ) && !(props.openOnHover && isActive.value && !isTop.value)\n    ) {\n      if (isActive.value !== value) {\n        firstEnter = true\n      }\n      isActive.value = value\n    }\n  })\n\n  const cursorTarget = ref<[x: number, y: number]>()\n  const availableEvents = {\n    onClick: (e: MouseEvent) => {\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      if (!isActive.value) {\n        cursorTarget.value = [e.clientX, e.clientY]\n      }\n      isActive.value = !isActive.value\n    },\n    onMouseenter: (e: MouseEvent) => {\n      isHovered = true\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      runOpenDelay()\n    },\n    onMouseleave: (e: MouseEvent) => {\n      isHovered = false\n      runCloseDelay()\n    },\n    onFocus: (e: FocusEvent) => {\n      if (matchesSelector(e.target as HTMLElement, ':focus-visible') === false) return\n\n      isFocused = true\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n\n      runOpenDelay()\n    },\n    onBlur: (e: FocusEvent) => {\n      isFocused = false\n      e.stopPropagation()\n\n      runCloseDelay({ minDelay: 1 })\n    },\n  }\n\n  const activatorEvents = computed(() => {\n    const events: Partial<typeof availableEvents> = {}\n\n    if (openOnClick.value) {\n      events.onClick = availableEvents.onClick\n    }\n    if (props.openOnHover) {\n      events.onMouseenter = availableEvents.onMouseenter\n      events.onMouseleave = availableEvents.onMouseleave\n    }\n    if (openOnFocus.value) {\n      events.onFocus = availableEvents.onFocus\n      events.onBlur = availableEvents.onBlur\n    }\n\n    return events\n  })\n\n  const contentEvents = computed(() => {\n    const events: Record<string, EventListener> = {}\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        isHovered = true\n        runOpenDelay()\n      }\n      events.onMouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    if (openOnFocus.value) {\n      events.onFocusin = (e: Event) => {\n        if (!(e.target as HTMLElement).matches(':focus-visible')) return\n        isFocused = true\n        runOpenDelay()\n      }\n      events.onFocusout = () => {\n        isFocused = false\n        runCloseDelay({ minDelay: 1 })\n      }\n    }\n\n    if (props.closeOnContentClick) {\n      const menu = inject(VMenuSymbol, null)\n      events.onClick = () => {\n        isActive.value = false\n        menu?.closeParents()\n      }\n    }\n\n    return events\n  })\n\n  const scrimEvents = computed(() => {\n    const events: Record<string, EventListener> = {}\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        if (firstEnter) {\n          isHovered = true\n          firstEnter = false\n          runOpenDelay()\n        }\n      }\n      events.onMouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    return events\n  })\n\n  watch(isTop, val => {\n    if (val && (\n      (props.openOnHover && !isHovered && (!openOnFocus.value || !isFocused)) ||\n      (openOnFocus.value && !isFocused && (!props.openOnHover || !isHovered))\n    ) && !contentEl.value?.contains(document.activeElement)) {\n      isActive.value = false\n    }\n  })\n\n  watch(isActive, val => {\n    if (!val) {\n      setTimeout(() => {\n        cursorTarget.value = undefined\n      })\n    }\n  }, { flush: 'post' })\n\n  const activatorRef = templateRef()\n  watchEffect(() => {\n    if (!activatorRef.value) return\n\n    nextTick(() => {\n      activatorEl.value = activatorRef.el\n    })\n  })\n\n  const targetRef = templateRef()\n  const target = computed(() => {\n    if (props.target === 'cursor' && cursorTarget.value) return cursorTarget.value\n    if (targetRef.value) return targetRef.el\n    return getTarget(props.target, vm) || activatorEl.value\n  })\n  const targetEl = computed(() => {\n    return Array.isArray(target.value)\n      ? undefined\n      : target.value\n  })\n\n  let scope: EffectScope\n  watch(() => !!props.activator, val => {\n    if (val && IN_BROWSER) {\n      scope = effectScope()\n      scope.run(() => {\n        _useActivator(props, vm, { activatorEl, activatorEvents })\n      })\n    } else if (scope) {\n      scope.stop()\n    }\n  }, { flush: 'post', immediate: true })\n\n  onScopeDispose(() => {\n    scope?.stop()\n  })\n\n  return { activatorEl, activatorRef, target, targetEl, targetRef, activatorEvents, contentEvents, scrimEvents }\n}\n\nfunction _useActivator (\n  props: ActivatorProps,\n  vm: ComponentInternalInstance,\n  { activatorEl, activatorEvents }: Pick<ReturnType<typeof useActivator>, 'activatorEl' | 'activatorEvents'>\n) {\n  watch(() => props.activator, (val, oldVal) => {\n    if (oldVal && val !== oldVal) {\n      const activator = getActivator(oldVal)\n      activator && unbindActivatorProps(activator)\n    }\n    if (val) {\n      nextTick(() => bindActivatorProps())\n    }\n  }, { immediate: true })\n\n  watch(() => props.activatorProps, () => {\n    bindActivatorProps()\n  })\n\n  onScopeDispose(() => {\n    unbindActivatorProps()\n  })\n\n  function bindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    bindProps(el, mergeProps(activatorEvents.value, _props))\n  }\n\n  function unbindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    unbindProps(el, mergeProps(activatorEvents.value, _props))\n  }\n\n  function getActivator (selector = props.activator): HTMLElement | undefined {\n    const activator = getTarget(selector, vm)\n\n    // The activator should only be a valid element (Ignore comments and text nodes)\n    activatorEl.value = activator?.nodeType === Node.ELEMENT_NODE ? activator : undefined\n\n    return activatorEl.value\n  }\n}\n\nfunction getTarget<T extends 'parent' | string | Element | ComponentPublicInstance | [x: number, y: number] | undefined> (\n  selector: T,\n  vm: ComponentInternalInstance\n): HTMLElement | undefined | (T extends any[] ? [x: number, y: number] : never) {\n  if (!selector) return\n\n  let target\n  if (selector === 'parent') {\n    let el = vm?.proxy?.$el?.parentNode\n    while (el?.hasAttribute('data-no-activator')) {\n      el = el.parentNode\n    }\n    target = el\n  } else if (typeof selector === 'string') {\n    // Selector\n    target = document.querySelector(selector)\n  } else if ('$el' in selector) {\n    // Component (ref)\n    target = selector.$el\n  } else {\n    // HTMLElement | Element | [x, y]\n    target = selector\n  }\n\n  return target\n}\n"],"mappings":"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","ignoreList":[]}