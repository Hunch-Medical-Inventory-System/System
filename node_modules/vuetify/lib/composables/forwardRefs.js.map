{"version":3,"file":"forwardRefs.js","names":["Refs","Symbol","getDescriptor","obj","key","currentObj","descriptor","Reflect","getOwnPropertyDescriptor","Object","getPrototypeOf","undefined","forwardRefs","target","refs","Proxy","get","has","startsWith","ref","value","val","bind","set","_","setupState","childRefs","queue","slice","length","shift","push"],"sources":["../../src/composables/forwardRefs.ts"],"sourcesContent":["// Types\nimport type { ComponentOptionsBase, ComponentPublicInstance, Ref, UnwrapRef } from 'vue'\nimport type { NonEmptyArray, UnionToIntersection } from '@/util'\n\nconst Refs = Symbol('Forwarded refs')\n\n/** Omit properties starting with P */\ntype OmitPrefix<\n  T,\n  P extends string,\n  E = Extract<keyof T, `${P}${any}`>,\n> = [E] extends [never] ? T : Omit<T, `${P}${any}`>\ntype OmitPrivate<T> = OmitPrefix<T, '$'>\n\n/** Omit keyof $props from T */\ntype OmitProps<T> = T extends { $props: any } ? Omit<T, keyof T['$props']> : T\n\nfunction getDescriptor (obj: any, key: PropertyKey) {\n  let currentObj = obj\n  while (currentObj) {\n    const descriptor = Reflect.getOwnPropertyDescriptor(currentObj, key)\n    if (descriptor) return descriptor\n    currentObj = Object.getPrototypeOf(currentObj)\n  }\n  return undefined\n}\n\nexport function forwardRefs<\n  T extends {},\n  U extends NonEmptyArray<Ref<HTMLElement | Omit<ComponentPublicInstance, '$emit' | '$slots'> | undefined>>,\n  UU = { [K in keyof U]: NonNullable<UnwrapRef<U[K]>> }[number],\n  UC = { [K in keyof U]: OmitPrivate<OmitProps<NonNullable<UnwrapRef<U[K]>>>> }[number],\n  R = T & UnionToIntersection<UC> & {\n    _allExposed: T | (\n      UU extends { $options: infer O }\n        ? O extends ComponentOptionsBase<any, infer E, any, any, any, any, any, any>\n          ? E\n          : never\n        : never\n    )\n  }\n> (target: T, ...refs: U): R {\n  (target as any)[Refs] = refs\n\n  return new Proxy(target, {\n    get (target, key) {\n      if (Reflect.has(target, key)) {\n        return Reflect.get(target, key)\n      }\n\n      // Skip internal properties\n      if (typeof key === 'symbol' || key.startsWith('$') || key.startsWith('__')) return\n\n      for (const ref of refs) {\n        if (ref.value && Reflect.has(ref.value, key)) {\n          const val = Reflect.get(ref.value, key)\n          return typeof val === 'function'\n            ? val.bind(ref.value)\n            : val\n        }\n      }\n    },\n    has (target, key) {\n      if (Reflect.has(target, key)) {\n        return true\n      }\n\n      // Skip internal properties\n      if (typeof key === 'symbol' || key.startsWith('$') || key.startsWith('__')) return false\n\n      for (const ref of refs) {\n        if (ref.value && Reflect.has(ref.value, key)) {\n          return true\n        }\n      }\n      return false\n    },\n    set (target, key, value) {\n      if (Reflect.has(target, key)) {\n        return Reflect.set(target, key, value)\n      }\n\n      // Skip internal properties\n      if (typeof key === 'symbol' || key.startsWith('$') || key.startsWith('__')) return false\n\n      for (const ref of refs) {\n        if (ref.value && Reflect.has(ref.value, key)) {\n          return Reflect.set(ref.value, key, value)\n        }\n      }\n\n      return false\n    },\n    getOwnPropertyDescriptor (target, key) {\n      const descriptor = Reflect.getOwnPropertyDescriptor(target, key)\n      if (descriptor) return descriptor\n\n      // Skip internal properties\n      if (typeof key === 'symbol' || key.startsWith('$') || key.startsWith('__')) return\n\n      // Check each ref's own properties\n      for (const ref of refs) {\n        if (!ref.value) continue\n        const descriptor = getDescriptor(ref.value, key) ?? ('_' in ref.value ? getDescriptor(ref.value._?.setupState, key) : undefined)\n        if (descriptor) return descriptor\n      }\n\n      // Recursive search up each ref's prototype\n      for (const ref of refs) {\n        const childRefs = ref.value && (ref.value as any)[Refs]\n        if (!childRefs) continue\n        const queue = childRefs.slice()\n        while (queue.length) {\n          const ref = queue.shift()\n          const descriptor = getDescriptor(ref.value, key)\n          if (descriptor) return descriptor\n          const childRefs = ref.value && (ref.value as any)[Refs]\n          if (childRefs) queue.push(...childRefs)\n        }\n      }\n\n      return undefined\n    },\n  }) as any\n}\n"],"mappings":"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","ignoreList":[]}